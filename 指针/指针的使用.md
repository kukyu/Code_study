# C 语言指针学习

## 学习 1 初识指针

```C
#include <stdio.h>
int main()
{
    int a = 0x11223344;
    int *pa = &a;
    char *pc = &a;
    printf("%p\n", pa);
    printf("%p\n", pa + 1);

    printf("%p\n", pc);
    printf("%p\n", pc + 1);
}
```

## 学习 2 指针简单使用 1

```C
# include <stdio.h>
int main()
{
    int arr[10]={1,2,3,4,5,6,7,8,9,10};
    int *p = arr; //arr数组中首元素地址
    int i = 0;
    for(i=0;i<5;i++)
    {
        printf("%d", *p);
        p+=2;
    }
    return 0;
}
```

## 学习 3 指针简单使用 2

指针-指针 得到中间元素个数,要是同一种数据类型

```C
# include <stdio.h>
int main()
{
   int arr[10]={8,2,3,4,5,6,7,8,9,20};
   printf("%d\n",&arr[9]-&arr[0]);
return 0;
}
//结果是9
```

## 学习 4 利用指针实现 strlen 函数的功能

strlen --求字符串长度

```C
#include <stdio.h>
int my_strlen(char *str)
{
    char *start = str;
    char *end = str;
    while (*end != '\0')
    {
        end++;
    }
    return end - start;
}
int main()
{
    char arr[] = "bit";
    int len = my_strlen(arr);
    printf("%d\n", len);
    return 0;
}
```

## 学习 5 指针和数组

```C
# include <stdio.h>
int main()
{
    int arr[10] = {0};
    printf("%p\n", arr);
    printf("%p\n", arr + 1); // +4
    printf("%p\n", &arr[0]);
    printf("%p\n", &arr[0] + 1);  // +4
    printf("%p\n", &arr); // 整个数组的地址40
    printf("%p\n", &arr+1); // +40

}
```

## 学习 6 二级指针

```C
#include <stdio.h>
int main()
{
   int a = 10;
   int *pa =&a;
   int **ppa = &pa;//ppa即二级指针
   printf("%d\n", **ppa);
   return 0;  //ans = 10
}
```

## 学习 7 指针数组

指针数组-存放指针

````C
#include <stdio.h>
int main()
{
   int a = 10;
   int b = 20;
   int c = 30;
   int *arr[3] = {&a, &b, &c}; //指针数组
   int i = 0;
   for(i=0;i<3;i++)
   {
    printf("%d\t", *arr[i]);
   }
   return 0;
}


数组指针的使用


```C
 # include <stdio.h>
 int main()
 {
   int arr1[]={1,2,3,4,5};
   int arr2[]={2,2,3,4,5};
   int arr3[]={3,2,3,4,5};
   int* parr[] = {arr1,arr2, arr3};
   int i = 0;
   int j=0;
   for(i=0;i<3;i++)
   {
      for(j=0;j<5;j++)
      {
         printf("%d",*(parr[i] +j));
      }
      printf("\n");
   }
   return 0;
 }
```


****
## 指针进阶

指针大小

```C
# include <stdio.h>
void test(int arr[])
{
   int sz = sizeof(arr) / sizeof(aCrr[0]);
   printf("%d\n", sz);

}
int main()
{
   int arr[10] = {0};
   test(arr);
   return 0;
}
````

### 字符指针

```C
# include <stdio.h>
int main()
{
  char arr[]="abcdef";
  char *pc = arr;
  printf("%s\n", arr);
  printf("%s\n",*pc);
  return 0;

}
```

```C
# include <stdio.h>
int main()
{
  const char *p="abcdef"; //abcdef 是常量字符串 最准确的写法是加const
//   *p = "w"; //  错误
  printf("%s\n", p);
//   printf("%c\n", *p);
  return 0;

}
```

常量字符串不能被修改

---

### 数组指针

```C
int arr[10]= {0};
int (*p)[10]=&arr;
// 上面的p叫数组指针
```

```C
 # include <stdio.h>
 int main()
 {
   int arr2[]={1,2,3,4,5,6,7, 8, 9,10};
   int (*pa)[10]=&arr2;
   int i = 0;
   for(i=0;i<10;i++)
   {
      printf("%d", (*pa)[i]); //*pa == arr1
      printf("%d", *(*pa+i)); //首元素代表地址进行加1操作 最后解引用

   }
   return 0;
 }
```

对上面进行简化

\*(p+i)==\*(arr2+i)==arr2[i]==p[i]

```C
# include <stdio.h>
int main()
{
  int arr2[]={1,2,3,4,5,6,7, 8, 9,10};
  int *p = arr2;
  int i = 0;
  for(i=0;i<10;i++)
  {
     printf("%d", *(p+i));
      printf("%d",*(arr2+i));
     printf("%d",arr2[i]);
     printf("%d",p[i]); //*(p+i)==*(arr2+i)==arr2[i]==p[i]
  }
  return 0;
}
```

数组指针用于二维数组以上比较方便

常规的方法 二维数组的遍历

```C
# include <stdio.h>
void printf1(int arr[3][5],int x,int y)//void 代表不返回
{
   int i=0;
   int j=0;
   for(i=0;i<x;i++)
   {
      for(j=0;j<y;j++)
      {
         printf("%d\t",arr[i][j]);
      }
      printf("\n");
   }

}
int main()
{
  int arr[3][5]={{1,2,3,4,5},{6,7, 8, 9,10},{2,3,4,5,6}};
  printf1(arr,3,5);//定义一个函数
  return 0;
}
```

二维数组的数组名是首元素的地址 即第一行的地址

```C
# include <stdio.h>
void printf1(int (*p)[5],int x,int y)//(*p)[5]指向第一行的地址
{
   int i=0;
   int j=0;
   for(i=0;i<x;i++)
   {
      for(j=0;j<y;j++)
      {
         printf("%d\t",*(*(p+i)+j));
         // printf("%d\t",(*(p+i))[j]);
         // printf("%d\t",p[i][j]);
         *(p+i)==*(arr2+i)==arr2[i]==p[i]
      }
      printf("\n");
   }

}
int main()
{
  int arr[3][5]={{1,2,3,4,5},{6,7, 8, 9,10},{2,3,4,5,6}};
  printf1(arr,3,5);//定义一个函数
  return 0;
}
```

### 一维数组传参

```C
# include <stdio.h>
void test(int arr[])
{}
void test(int arr[10])
{}
void test(int *arr)
{}
void test2(int *arr2[20])
{}
void test2(int **arr2)
{}
int main()
{
  int arr[10]={0};
  int *arr2[20] = 20;
  test(arr); //传参数组名 首元素地址 可以指针
  test2(arr2);
}
```

### 二维数组的传参

```C
# include <stdio.h>
void test(int arr[3][5])
{}
void test(int arr[3][]) //写法错误 不能省略列，也不能省略所有
{}
void test(int arr[][5])
{}
void test1(int *arr) //二维数组首地址是第一行数组的地址，不能存放int整型中
{}
void test1(int *(arr)[5]) //数组指针 指针指向五个元素的一维数组的地址
{}
int main()
{
  int arr[3][5]={0};
  test(arr);
  test1(arr);

```

思考：一级指针可以传什么变量

```C
# include <stdio.h>
void test(int *p)
{}
int main()
{
  int a=10;
  int *p = &a;
  test(&a);//ok
  test(p); // ok
}
```

二级指针传参

```C
# include <stdio.h>
void test(int **p)
{
  printf("%d",**p);
}
int main()
{
  int a=10;
  int *p = &a;
  int **pp =&p;
  test(pp);//ok
  test(&p); // ok
  return 0;
}
```

### 函数指针

```C
# include <stdio.h>
int Add(int x, int y)
{
  int z=0;
  z=x+y;
  return z;
}
int main()
{
  int a=10;
  int b=20;
  printf("%d\n", Add(a,b));
  printf("%p\n", &Add);
  printf("%p\n", Add); //&函数名和函数名都是函数地址
  int (*pa)(int, int) = Add;  //函数指针
  printf("%d\n",(*pa)(3, 3));
  printf("%d\n",(pa)(3, 3));
  return 0;
}
```

//代码 1

((void(\*)())0)();//调用 0 地址处的函数

void(\*)()-函数指针类型

//把 0 强制转换成函数指针类型 0 就是一个函数的地址

&emsp;\&emsp;这是空格 \&nbsp;这是换行

&nbsp;

普通写法

```C
#include <stdio.h>
int Add(int x, int y)
{
  int z = 0;
  z = x + y;
  return z;
}
int Sub(int x, int y)
{
  int z = 0;
  z = x - y;
  return z;
}
int Mul(int x, int y)
{
  int z = 0;
  z = x * y;
  return z;
}
int Div(int x, int y)
{
  int z = 0;
  z = x / y;
  return z;
}
int main()
{
  // 指针数组
  // int * arr[5];
  //需要一个数组 这个数组可以存放4个函数的地址-函数指针的数组
  int (*parr[4])(int,int) ={Add,Sub, Mul,Div};
  int i=0;
  for(i-0;i<4;i++)
  {
    printf("%d\n",parr[i](2,3));
  }
  return 0;
}
```

#### 函数指针数组实战//计算器

```C
# include<stdio.h>
void menu()
{
  printf("******************\n");
  printf("***1.add  2.sub***\n");
  printf("***3.mul  4.div***\n");
  printf("***   0.exit   ***\n");
  printf("******************\n");
}

int Add(int x, int y)
{
  return x+y;
}
int Sub(int x, int y)
{
  int z = 0;
  z = x - y;
  return z;
}
int Mul(int x, int y)
{
  int z = 0;
  z = x * y;
  return z;
}
int Div(int x, int y)
{
  int z = 0;
  z = x / y;
  return z;
}
int main()
{
  int input = 0;
  int x=0;
  int y=0;
  do
  {
    menu();
    printf("请选择：>");
    scanf("%d", &input);
    switch (input)
    {
    case 1:
      printf("请输入两个数:>");
      scanf("%d%d",&x,&y);
      printf("%d\n",Add(x,y));
      break;
    case 2:
      printf("请输入两个数:>");
      scanf("%d%d",&x,&y);
      printf("%d\n",Sub(x,y));
      break;
    case 3:
      printf("请输入两个数:>");
      scanf("%d%d",&x,&y);
      printf("%d\n",Mul(x,y));
      break;
    case 4:
      printf("请输入两个数:>");
      scanf("%d%d",&x,&y);
      printf("%d\n",Div(x,y));
      break;
    case 0:
      printf("退出\n");
      break;
    default:
      printf("选择错误\n");
      break;
    }
  } while (input);
  return 0;
}
```

函数指针数组--转移表

```C
#include <stdio.h>
void menu()
{
  printf("******************\n");
  printf("***1.add  2.sub***\n");
  printf("***3.mul  4.div***\n");
  printf("***   0.exit   ***\n");
  printf("******************\n");
}

int Add(int x, int y)
{
  return x + y;
}
int Sub(int x, int y)
{
  int z = 0;
  z = x - y;
  return z;
}
int Mul(int x, int y)
{
  int z = 0;
  z = x * y;
  return z;
}
int Div(int x, int y)
{
  int z = 0;
  z = x / y;
  return z;
}
int main()
{
  int input = 0;
  int x = 0;
  int y = 0;
  int (*pfArr[])(int, int) = {0, Add, Sub, Mul, Div};
  do
  {
    menu();
    printf("请选择：>");
    scanf("%d", &input);
    if (input >=1 && input<= 4)
    {
      printf("请输入两个数:>");
      scanf("%d%d", &x, &y);
      int ret = pfArr[input](x, y);
      printf("%d\n", ret);
    }
    else if(input==0)
    {
      printf("退出\n");
    }
    else
    {
      printf("选择错误\n");
    }

  } while (input);
  return 0;
}

```

&nbsp;

#### 回调函数

通过函数指针调用的函数

示例

```C
#include <stdio.h>
void print(char *str)
{
  printf("hehe:%s", str);
}
void test(void (*p)(char *))
{
  printf("test\n");
  p("bit");
}
int main()
{
  test(print);
  return 0;
}
```

优化函数

```C
# include<stdio.h>
void menu()
{
  printf("******************\n");
  printf("***1.add  2.sub***\n");
  printf("***3.mul  4.div***\n");
  printf("***   0.exit   ***\n");
  printf("******************\n");
}

int Add(int x, int y)
{
  return x+y;
}
int Sub(int x, int y)
{
  int z = 0;
  z = x - y;
  return z;
}
int Mul(int x, int y)
{
  int z = 0;
  z = x * y;
  return z;
}
int Div(int x, int y)
{
  int z = 0;
  z = x / y;
  return z;
}
int Calc(int(*pf)(int, int)) //接收函数地址
{
    int x=0;
    int y=0;
    printf("请输入两个数:>");
    scanf("%d%d",&x,&y);
    printf("%d\n",pf(x,y));
}
int main()
{
  int input = 0;
  int x=0;
  int y=0;
  do
  {
    menu();
    printf("请选择：>");
    scanf("%d", &input);
    switch (input)
    {
    case 1:
      Calc(Add); //Add函数地址
      break;
    case 2:
      Calc(Sub);
      break;
    case 3:
      Calc(Mul);
      break;
    case 4:
      Calc(Div);
      break;
    case 0:
      printf("退出\n");
      break;
    default:
      printf("选择错误\n");
      break;
    }
  } while (input);
  return 0;
}
```

拓展：指向函数指针数组的指针

&nbsp;

指针回顾

`int * arr[10];` //指针数组

`int*(*pa)[10] = &arr;`//数组指针

`int (*pAdd)(int, int) = Add;` //函数指针

`int (*pAdd[5])(int, int)={Add, Bff};` //函数指针的数组

`int (*(*pAdd)[5])(int, int)=&pArr;` //指向函数指针数组的指针

